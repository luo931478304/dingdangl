<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è®¢è´§ç³»ç»Ÿ | Pro v5.3 (Protected)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{--app-bg:#F5F5F7;--card-bg:#FFFFFF;--primary:#0071e3;--primary-hover:#0077ED;--danger:#FF3B30;--success:#34C759;--text-main:#1D1D1F;--text-sec:#86868B;--border-light:#E5E5EA;--input-bg:#F5F5F7;--radius-md:12px;--radius-lg:18px;--shadow-card:0 4px 12px rgba(0,0,0,0.03);--shadow-float:0 12px 30px rgba(0,0,0,0.12)}*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Inter","PingFang SC",sans-serif;user-select:none;-webkit-user-select:none}body{background-color:var(--app-bg);color:var(--text-main);line-height:1.5;padding-bottom:120px;-webkit-font-smoothing:antialiased}.navbar{background:rgba(255,255,255,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,0,0,0.08);padding:0.8rem 1.5rem;position:sticky;top:0;z-index:100;display:flex;justify-content:space-between;align-items:center}.brand{font-size:1.1rem;font-weight:600;color:#000;display:flex;align-items:center;gap:10px}.brand i{color:var(--primary);font-size:1.2rem}.container{max-width:960px;margin:30px auto;padding:0 20px;animation:slideIn 0.4s cubic-bezier(0.2,0.8,0.2,1)}@keyframes slideIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}.card{background:var(--card-bg);border-radius:var(--radius-lg);box-shadow:var(--shadow-card);margin-bottom:24px;border:1px solid rgba(0,0,0,0.02);overflow:hidden}.card-header{padding:16px 24px;border-bottom:1px solid var(--border-light);font-weight:600;font-size:0.95rem;color:var(--text-main);display:flex;justify-content:space-between;align-items:center;background:#fff}.card-body{padding:24px}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px}.form-group label{display:block;font-size:0.8rem;color:var(--text-sec);margin-bottom:8px;font-weight:500}.form-control{width:100%;padding:12px 14px;border:1px solid transparent;background:var(--input-bg);border-radius:10px;outline:none;font-size:15px;color:var(--text-main);transition:all 0.2s;user-select:text;-webkit-user-select:text}.form-control:focus{background:#fff;border-color:var(--primary);box-shadow:0 0 0 4px rgba(0,113,227,0.1)}.input-wrapper{position:relative}.clear-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#C7C7CC;cursor:pointer;display:none}.form-control:focus+.clear-btn,.form-control:not(:placeholder-shown)+.clear-btn{display:block}.table-container{overflow-x:auto}.ui-table{width:100%;border-collapse:collapse;min-width:800px}.ui-table th{background:#FAFAFA;padding:12px 16px;text-align:left;font-size:0.75rem;color:var(--text-sec);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid var(--border-light)}.ui-table td{padding:8px 16px;border-bottom:1px solid var(--border-light)}.ui-table input{width:100%;border:none;padding:8px;background:transparent;outline:none;font-size:14px;border-radius:6px;user-select:text}.ui-table input:focus{background:#E8F0FE;color:var(--primary)}.action-btn{background:white;border:none;padding:8px 16px;border-radius:20px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;font-size:14px;color:var(--primary);font-weight:500;transition:all 0.2s;background:rgba(0,113,227,0.08)}.action-btn:hover{background:rgba(0,113,227,0.15);transform:scale(1.02)}.action-btn:active{transform:scale(0.96)}.btn-sm{padding:4px 10px;font-size:12px;border-radius:6px;background:transparent}.btn-sm:hover{background:rgba(0,0,0,0.05)}.bottom-bar{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:92%;max-width:800px;background:rgba(255,255,255,0.9);backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);padding:12px 24px;box-shadow:0 10px 40px rgba(0,0,0,0.15);border:1px solid rgba(255,255,255,0.5);border-radius:100px;display:flex;justify-content:space-between;align-items:center;z-index:99}.main-btn{border:none;padding:12px 28px;border-radius:30px;cursor:pointer;font-size:15px;font-weight:600;color:white;transition:all 0.2s;display:flex;gap:8px;align-items:center;box-shadow:0 4px 10px rgba(0,113,227,0.3)}.btn-contract{background:var(--primary)}.btn-contract:hover{background:#0062c4;transform:translateY(-2px)}.btn-order{background:#000000;box-shadow:0 4px 10px rgba(0,0,0,0.3)}.btn-order:hover{background:#333333;transform:translateY(-2px)}.modal-backdrop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);backdrop-filter:blur(5px);z-index:2000;display:none;opacity:0;transition:opacity 0.3s ease;justify-content:center;align-items:center}.modal-backdrop.active{opacity:1;display:flex}.modal-box{background:#fff;width:100%;max-width:600px;height:80vh;border-radius:20px;display:flex;flex-direction:column;box-shadow:0 25px 50px rgba(0,0,0,0.25);transform:translateY(50px);transition:transform 0.3s cubic-bezier(0.2,0.8,0.2,1);overflow:hidden}.modal-backdrop.active .modal-box{transform:translateY(0)}.modal-header{padding:16px 20px;background:#fff;border-bottom:1px solid var(--border-light);display:flex;justify-content:space-between;align-items:center;z-index:10}.modal-title{font-size:17px;font-weight:600}.modal-close{font-size:15px;color:var(--primary);background:none;border:none;cursor:pointer;font-weight:500}.alert-backdrop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.2);z-index:3000;display:none;opacity:0;transition:opacity 0.2s;justify-content:center;align-items:center}.alert-backdrop.active{opacity:1;display:flex}.ios-alert-box{background:rgba(245,245,247,0.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);width:270px;border-radius:14px;text-align:center;box-shadow:0 0 0 1px rgba(0,0,0,0.05),0 10px 30px rgba(0,0,0,0.2);transform:scale(1.1);transition:transform 0.2s cubic-bezier(0.34,1.56,0.64,1);overflow:hidden}.alert-backdrop.active .ios-alert-box{transform:scale(1)}.alert-content{padding:20px 16px 20px}.alert-title{font-size:17px;font-weight:600;margin-bottom:4px;color:#000}.alert-msg{font-size:13px;color:#000;line-height:1.4}.alert-actions{display:flex;border-top:0.5px solid rgba(60,60,67,0.2)}.alert-btn{flex:1;background:transparent;border:none;padding:12px 0;font-size:17px;color:var(--primary);cursor:pointer;font-weight:400;border-right:0.5px solid rgba(60,60,67,0.2);margin:0}.alert-btn:last-child{border-right:none}.alert-btn:active{background:rgba(0,0,0,0.05)}.alert-btn.bold{font-weight:600}.alert-btn.destructive{color:var(--danger);font-weight:600}.list-group{padding:0 20px 20px;overflow-y:auto;flex:1}.list-item{padding:14px 0;border-bottom:1px solid var(--border-light);display:flex;justify-content:space-between;align-items:center;cursor:pointer}.list-item:hover .list-info b{color:var(--primary)}.list-info b{display:block;font-size:15px;margin-bottom:2px;transition:color 0.2s}.list-info small{color:var(--text-sec);font-size:13px}.loading{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.8);backdrop-filter:blur(10px);z-index:4000;display:none;flex-direction:column;justify-content:center;align-items:center}.print-area{position:fixed;left:0;top:0;transform:translate(-9999px,-9999px);width:210mm;background:white;padding:12mm 15mm;font-family:"SimSun","å®‹ä½“",serif;color:#000;box-sizing:border-box}.pdf-title{text-align:center;font-size:18pt;font-weight:bold;margin-bottom:10px;letter-spacing:3px}.pdf-table{width:100%;border-collapse:collapse;font-size:8.5pt;margin-bottom:8px}.pdf-table th,.pdf-table td{border:1px solid #000;padding:3px 4px}.order-header{border-bottom:2px solid #000;padding-bottom:10px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:flex-end}.order-title{font-size:24pt;font-weight:900;letter-spacing:5px}.order-table{width:100%;border-collapse:collapse;font-size:10pt;margin-bottom:15px}.order-table th,.order-table td{border:1px solid #000;padding:8px}.pdf-info-table{width:100%;font-size:9pt;margin-bottom:8px}.pdf-val{border-bottom:1px solid #000;padding:0 5px;display:inline-block;min-width:50px;text-align:center;font-weight:bold}.pdf-p{font-size:9pt;line-height:1.4;margin-bottom:5px;text-align:justify}.pdf-h1{font-size:10pt;font-weight:bold;margin-top:8px;margin-bottom:4px;background:#f0f0f0;padding:2px 5px;border-left:3px solid #000}.pdf-terms{font-size:7.5pt;line-height:1.35;text-align:justify;white-space:pre-wrap}.pdf-sign-area{display:flex;justify-content:space-between;margin-top:10px;border-top:1.5px solid #000;padding-top:8px}.pdf-sign-col{width:48%;font-size:9pt;line-height:1.5}.pdf-sign-title{font-weight:bold;font-size:10.5pt;margin-bottom:5px}.pdf-kv{display:flex;margin-bottom:1px}.pdf-k{width:75px;font-weight:bold;flex-shrink:0}.pdf-v{flex:1;word-break:break-all}.order-box{border:1px solid #000;padding:10px;margin-bottom:15px;display:flex;font-size:10pt;gap:20px}.order-box-col{flex:1;display:flex;flex-direction:column;gap:5px}.order-row{display:flex}.order-label{font-weight:bold;width:70px;flex-shrink:0}.order-sign-box{border-top:1px solid #000;margin-top:40px;padding-top:10px;display:flex;justify-content:space-between}.order-sign-item{width:40%;text-align:center}.order-sign-line{border-bottom:1px solid #000;height:30px;margin-top:20px}
</style>
<!-- é˜²è°ƒè¯•è„šæœ¬ -->
<script>
    document.addEventListener('contextmenu',e=>e.preventDefault());document.onkeydown=function(e){if(e.keyCode==123||(e.ctrlKey&&e.shiftKey&&e.keyCode=='I'.charCodeAt(0))||(e.ctrlKey&&e.shiftKey&&e.keyCode=='J'.charCodeAt(0))||(e.ctrlKey&&e.keyCode=='U'.charCodeAt(0))||(e.ctrlKey&&e.keyCode=='S'.charCodeAt(0))){return false}};
</script>
</head>
<body>
<div class="loading" id="loading"><i class="fas fa-spinner fa-spin" style="font-size:2rem;color:var(--text-sec);margin-bottom:10px"></i><div style="font-size:0.9rem;font-weight:500;color:var(--text-main)">å¤„ç†ä¸­...</div></div>
<nav class="navbar"><div class="brand"><i class="fas fa-layer-group"></i><span>Order<span style="font-weight:400">System</span></span></div><div style="display:flex;gap:10px"><button onclick="openHistoryModal()" class="action-btn"><i class="fas fa-clock"></i></button><button onclick="openCustModal()" class="action-btn"><i class="fas fa-user-friends"></i></button><button onclick="backupAll()" class="action-btn"><i class="fas fa-cloud-download-alt"></i></button><button onclick="resetAll()" class="action-btn" style="color:var(--danger)"><i class="fas fa-plus"></i></button></div></nav>
<datalist id="product-options"><option value="æŠ½çº¸ç›’"><option value="åŒæ’ç›’"><option value="æ‰£åº•ç›’"><option value="æ°”å«ç›’"><option value="æŠ½å±‰ç›’"><option value="å¹³ç²˜ç›’"><option value="å¤©åœ°ç›–ç›’"><option value="é£æœºç›’"></datalist>
<datalist id="material-options"><option value="350Gç™½å¡"><option value="250Gç™½å¡"><option value="375Gé“¶å¡"><option value="ç‰›çš®çº¸"></datalist>
<datalist id="customer-list-options"></datalist>
<div class="container"><div class="card"><div class="card-header"><span>åŸºç¡€ä¿¡æ¯</span><span class="auto-save-status" id="save-status" style="font-size:12px;color:var(--success);display:none">å·²ä¿å­˜</span></div><div class="card-body form-grid"><div class="form-group"><label>å•æ®ç¼–å·</label><div style="display:flex;gap:10px;"><div class="input-wrapper" style="flex:1"><input type="text" class="form-control" id="c-no" onchange="saveData()"><i class="fas fa-times-circle clear-btn" onclick="clearInput('c-no')"></i></div><button class="action-btn" onclick="genNo()" title="ç”Ÿæˆ"><i class="fas fa-sync-alt"></i></button></div></div><div class="form-group"><label>ç­¾çº¦åœ°ç‚¹</label><input type="text" class="form-control" id="c-loc" value="éƒ‘å·" onchange="saveData()"></div><div class="form-group"><label>ç­¾çº¦æ—¥æœŸ</label><input type="date" class="form-control" id="c-date" onchange="saveData()"></div><div class="form-group"><label>å®¢æˆ·åç§° (ç”²æ–¹)</label><div class="input-wrapper"><input type="text" class="form-control" id="party-a" list="customer-list-options" placeholder="é€‰æ‹©æˆ–è¾“å…¥" onchange="onPartyAChange();saveData()" style="border-left:3px solid var(--primary)"><i class="fas fa-times-circle clear-btn" onclick="clearInput('party-a')"></i></div></div></div></div><div class="card"><div class="card-header"><span>äº§å“æ˜ç»†</span><button class="action-btn btn-sm" onclick="addRow()" style="color:var(--primary)"><i class="fas fa-plus"></i></button></div><div class="table-container"><table class="ui-table"><thead><tr><th width="40" style="text-align:center">#</th><th width="90">æ“ä½œ</th><th>äº§å“åç§°</th><th>æè´¨</th><th>å°ºå¯¸</th><th width="80">æ•°é‡</th><th width="90">å•ä»·</th><th width="100">åˆè®¡</th></tr></thead><tbody id="p-list"></tbody></table></div><div style="padding:20px;background:#fafafa;border-top:1px solid var(--border-light);display:flex;gap:30px;align-items:flex-start;"><div style="flex:1;"><label style="font-size:12px;color:var(--text-sec);display:block;margin-bottom:6px;">å·¥è‰º/å¤‡æ³¨è¯´æ˜</label><textarea class="form-control" id="craft" rows="2" style="min-height:60px;font-size:13px;background:white" onchange="saveData()"></textarea></div><div style="text-align:right;min-width:180px;"><div style="font-size:12px;color:var(--text-sec)">è®¢å•æ€»é¢</div><div style="font-size:1.8rem;font-weight:700;color:var(--text-main);letter-spacing:-0.5px" id="total-display">Â¥0.00</div></div></div></div><div class="card"><div class="card-header"><span>æ¡æ¬¾ä¸ç­¾çº¦</span></div><div class="card-body"><div class="form-group" style="margin-bottom:24px"><label style="color:var(--primary);font-weight:600">æˆ‘æ–¹ä¸»ä½“ (ä¹™æ–¹)</label><select class="form-control" id="party-b-select" onchange="updatePartyB();saveData()"><option value="moyu">éƒ‘å·å¢¨äºˆæ–‡åŒ–åˆ›æ„æœ‰é™å…¬å¸</option><option value="xinyun">æ²³å—çœæ–°è¿åŒ…è£…çº¸å“æœ‰é™å…¬å¸</option><option value="chuangyi">æ²³å—çœåˆ›è‰ºä¼—åˆåŒ…è£…æœ‰é™è´£ä»»å…¬å¸</option></select><input type="hidden" id="sign-b-comp"><input type="hidden" id="sign-b-code"><input type="hidden" id="sign-b-bank"><input type="hidden" id="sign-b-acc"></div><div class="form-grid"><div class="form-group"><label>äº¤è´§æ—¥æœŸ</label><input class="form-control" id="term-date" value="ä»˜æ¬¾åè´¢åŠ¡æ”¶æ¬¾æ¬¡æ—¥èµ· 10 å¤©å‘è´§" onchange="saveData()"></div><div class="form-group"><label>äº¤è´§åœ°å€</label><input class="form-control" id="term-addr" value="ç”²æ–¹æŒ‡å®šåœ°å€" onchange="saveData()"></div><div class="form-group"><label>ç»“ç®—æ–¹å¼</label><input class="form-control" id="term-pay" value="å…¨æ¬¾" onchange="saveData()"></div></div><div style="margin-top:20px;border-top:1px dashed var(--border-light);padding-top:20px;"><div class="form-group" style="margin-bottom:15px"><label>éªŒæ”¶æ ‡å‡† (åˆåŒæ¡æ¬¾)</label><textarea class="form-control" id="term-check" rows="3" onchange="saveData()" style="font-size:13px"></textarea></div><div class="form-group"><label>è¿çº¦è´£ä»» (åˆåŒæ¡æ¬¾)</label><textarea class="form-control" id="term-liab" rows="5" onchange="saveData()" style="font-size:13px"></textarea></div></div><div class="form-grid" style="margin-top:24px"><div class="form-group"><label>ç”²æ–¹æˆæƒäºº</label><input class="form-control" id="sign-a-user" onchange="saveData()"></div><div class="form-group"><label>ç”²æ–¹ç”µè¯</label><input class="form-control" id="sign-a-phone" onchange="saveData()"></div><div class="form-group"><label>ç”²æ–¹åœ°å€</label><input class="form-control" id="sign-a-addr" onchange="saveData()"></div><div class="form-group"><label>ä¹™æ–¹æˆæƒäºº</label><input class="form-control" id="sign-b-user" onchange="saveData()"></div></div></div></div></div><div class="bottom-bar"><button class="action-btn" onclick="saveToHistory()" style="background:transparent;color:var(--primary);font-weight:600">æš‚å­˜</button><div style="display:flex;gap:12px;"><button class="main-btn btn-contract" onclick="exportContract()">åˆåŒ</button><button class="main-btn btn-order" onclick="exportOrder()">è®¢è´§å•</button></div></div>
<div id="alert-backdrop" class="alert-backdrop"><div class="ios-alert-box"><div class="alert-content"><div id="alert-title" class="alert-title">æç¤º</div><div id="alert-msg" class="alert-msg">å†…å®¹</div></div><div id="alert-actions" class="alert-actions"></div></div></div><div id="cust-modal" class="modal-backdrop"><div class="modal-box"><div class="modal-header"><button class="action-btn btn-sm" onclick="document.getElementById('import-file').click()">å¯¼å…¥</button><span class="modal-title">å®¢æˆ·åˆ—è¡¨</span><button class="modal-close" onclick="closeModal('cust-modal')">å®Œæˆ</button></div><div style="padding:10px 20px 0;"><input type="file" id="import-file" style="display:none" onchange="importData(this)"><button class="action-btn" onclick="toggleCustForm(true)" style="width:100%;justify-content:center;background:var(--primary);color:white">+ æ·»åŠ æ–°å®¢æˆ·</button></div><div id="cust-form-area" style="display:none;background:#F2F2F7;padding:15px;margin:15px 20px;border-radius:12px;"><div class="form-grid" style="gap:10px"><input class="form-control" id="cust-name" placeholder="å…¬å¸åç§°*" style="background:white"><input class="form-control" id="cust-contact" placeholder="è”ç³»äºº" style="background:white"><input class="form-control" id="cust-phone" placeholder="ç”µè¯" style="background:white"><input class="form-control" id="cust-addr" placeholder="åœ°å€" style="background:white"></div><div style="margin-top:10px;display:flex;gap:10px;"><button class="action-btn" onclick="toggleCustForm(false)" style="flex:1">å–æ¶ˆ</button><button class="action-btn" onclick="saveCustomer()" style="flex:1;background:var(--primary);color:white;">ä¿å­˜</button></div></div><div class="list-group" id="cust-list"></div></div></div><div id="history-modal" class="modal-backdrop"><div class="modal-box"><div class="modal-header"><div style="width:30px"></div><span class="modal-title">å†å²è®¢å•</span><button class="modal-close" onclick="closeModal('history-modal')">å®Œæˆ</button></div><div style="padding:15px 20px;"><input class="form-control" id="history-search" placeholder="ğŸ” æœç´¢å®¢æˆ·æˆ–æ—¥æœŸ" oninput="renderHistoryList()" style="background:#E3E3E8;"></div><div class="list-group" id="history-list"></div></div></div><div id="print-contract-container" class="print-area"><div class="pdf-title">è®¢ è´§ åˆ åŒ</div><table class="pdf-info-table"><tr><td width="40%">åˆåŒç¼–å·ï¼š<span class="pdf-val" id="p-no"></span></td><td width="35%">ç­¾çº¦åœ°ç‚¹ï¼š<span class="pdf-val" id="p-loc"></span></td><td width="25%" align="right">ç­¾çº¦æ—¶é—´ï¼š<span class="pdf-val" id="p-date"></span></td></tr><tr><td colspan="3"><div style="margin-top:5px"><span style="font-weight:bold">ç”²æ–¹ï¼ˆéœ€æ–¹ï¼‰ï¼š</span><span class="pdf-val" style="min-width:200px;text-align:left" id="p-party-a"></span></div><div style="margin-top:2px"><span style="font-weight:bold">ä¹™æ–¹ï¼ˆä¾›æ–¹ï¼‰ï¼š</span><span id="p-party-b-top"></span></div></td></tr></table><div class="pdf-p">ä¾›éœ€åŒæ–¹æœ¬ç€ç›¸äº’ä¿¡ä»»ã€å¹³ç­‰äº’åˆ©çš„åŸåˆ™ï¼Œç»åå•†è¾¾æˆä¸€è‡´ï¼ŒåŒæ–¹å°±å…·ä½“äº‹å®œç­¾è®¢åˆåŒå¦‚ä¸‹ï¼š</div><div class="pdf-h1">ä¸€ã€äº§å“åç§°è§„æ ¼æ•°é‡å¦‚ä¸‹:</div><table class="pdf-table"><thead><tr><th width="5%">åº</th><th width="23%">äº§å“åç§°åŠè§„æ ¼</th><th width="18%">æè´¨è¦æ±‚</th><th width="12%">æˆå“å°ºå¯¸</th><th width="12%">æ•°é‡</th><th width="12%">å•ä»·</th><th width="13%">åˆè®¡</th></tr></thead><tbody id="p-tbody"></tbody><tfoot><tr><td colspan="2">äººæ°‘å¸(å¤§å†™)</td><td colspan="3" style="font-weight:bold;text-align:left" id="p-total-cn"></td><td>å°å†™</td><td style="font-weight:bold;text-align:right" id="p-total-num"></td></tr><tr><td colspan="7" style="text-align:left;padding:5px"><span style="font-weight:bold">å·¥è‰ºè¯´æ˜ï¼š</span><span id="p-craft"></span></td></tr></tfoot></table><div class="pdf-p" style="margin-top:5px"><span style="font-weight:bold">äºŒã€äº¤è´§æ—¥æœŸï¼š</span><span id="p-del-date"></span><br><span style="font-weight:bold">ä¸‰ã€äº¤è´§åœ°å€åŠè´¹ç”¨æ‰¿æ‹…ï¼š</span><span id="p-del-addr"></span><br><span style="font-weight:bold">å››ã€ç»“ç®—æ–¹å¼ï¼š</span><span id="p-pay"></span></div><div class="pdf-h1">äº”ã€éªŒæ”¶æ ‡å‡†å’Œæ–¹å¼ï¼š</div><div class="pdf-terms" id="p-terms-check"></div><div class="pdf-h1">å…­ã€è¿çº¦è´£ä»»ï¼š</div><div class="pdf-terms" id="p-terms-liab"></div><div class="pdf-sign-area"><div class="pdf-sign-col"><div class="pdf-sign-title">ç”²æ–¹ï¼ˆéœ€æ–¹ï¼‰</div><div class="pdf-kv"><div class="pdf-k">å•ä½åç§°ï¼š</div><div class="pdf-v" id="p-sign-comp-a"></div></div><div class="pdf-kv"><div class="pdf-k">åœ°å€ï¼š</div><div class="pdf-v" id="p-sign-addr-a"></div></div><div class="pdf-kv"><div class="pdf-k">ç”µè¯ï¼š</div><div class="pdf-v" id="p-sign-phone-a"></div></div><div class="pdf-kv"><div class="pdf-k">æˆæƒç­¾çº¦äººï¼š</div><div class="pdf-v" id="p-sign-user-a"></div></div><div style="margin-top:15px;color:#999;text-align:right;padding-right:20px">(ç›–ç« )</div></div><div class="pdf-sign-col"><div class="pdf-sign-title">ä¹™æ–¹ï¼ˆä¾›æ–¹ï¼‰</div><div class="pdf-kv"><div class="pdf-k">å•ä½åç§°ï¼š</div><div class="pdf-v" id="p-sign-comp-b"></div></div><div class="pdf-kv"><div class="pdf-k">ä¿¡ç”¨ä»£ç ï¼š</div><div class="pdf-v" id="p-sign-code-b"></div></div><div class="pdf-kv"><div class="pdf-k">å¼€æˆ·é“¶è¡Œï¼š</div><div class="pdf-v" id="p-sign-bank-b"></div></div><div class="pdf-kv"><div class="pdf-k">å¼€æˆ·è´¦å·ï¼š</div><div class="pdf-v" id="p-sign-acc-b"></div></div><div class="pdf-kv"><div class="pdf-k">æˆæƒç­¾çº¦äººï¼š</div><div class="pdf-v" id="p-sign-user-b"></div></div><div style="margin-top:2px;color:#999;text-align:right;padding-right:20px">(ç›–ç« )</div></div></div></div><div id="print-order-container" class="print-area"><div class="order-header"><div class="order-title">äº§å“è®¢è´§å•</div><div style="text-align:right"><div class="order-sub">NO: <span id="o-no"></span></div><div class="order-sub">Date: <span id="o-date"></span></div></div></div><div class="order-box"><div class="order-box-col"><div style="font-weight:bold;font-size:11pt;margin-bottom:5px;border-bottom:1px dashed #ccc;">ä¾›æ–¹ (Seller)</div><div class="order-row"><span class="order-label">å ç§°ï¼š</span><span id="o-seller-name"></span></div><div class="order-row"><span class="order-label">è”ç³»äººï¼š</span><span id="o-seller-contact"></span></div></div><div class="order-box-col"><div style="font-weight:bold;font-size:11pt;margin-bottom:5px;border-bottom:1px dashed #ccc;">éœ€æ–¹ (Buyer)</div><div class="order-row"><span class="order-label">å ç§°ï¼š</span><span id="o-buyer-name"></span></div><div class="order-row"><span class="order-label">è”ç³»äººï¼š</span><span id="o-buyer-contact"></span></div><div class="order-row"><span class="order-label">ç”µ è¯ï¼š</span><span id="o-buyer-phone"></span></div><div class="order-row"><span class="order-label">åœ° å€ï¼š</span><span id="o-buyer-addr"></span></div></div></div><table class="order-table"><thead><tr><th width="5%">NO.</th><th>äº§å“åç§° (Product)</th><th>æè´¨ (Material)</th><th>å°ºå¯¸ (Size)</th><th width="10%">æ•°é‡</th><th width="10%">å•ä»·</th><th width="12%">é‡‘é¢</th></tr></thead><tbody id="o-tbody"></tbody><tfoot><tr><td colspan="4" style="border:none;text-align:right;font-weight:bold;padding-right:10px;">åˆè®¡ (Total):</td><td style="font-weight:bold;text-align:center" id="o-total-qty"></td><td style="border:none;"></td><td style="font-weight:bold;text-align:right" id="o-total-money"></td></tr></tfoot></table><div style="border:1px solid #000;padding:10px;min-height:60px;margin-bottom:15px;font-size:10pt;"><span style="font-weight:bold">å¤‡æ³¨è¯´æ˜ (Notes)ï¼š</span><div id="o-craft" style="white-space:pre-wrap;margin-top:5px;"></div></div><div style="font-size:10pt;line-height:1.6"><div><span style="font-weight:bold">äº¤è´§æ—¥æœŸï¼š</span><span id="o-date-del"></span></div><div><span style="font-weight:bold">æ”¶è´§åœ°å€ï¼š</span><span id="o-addr-del"></span></div><div><span style="font-weight:bold">æ”¶æ¬¾è´¦å·ï¼š</span><span id="o-bank-info"></span></div></div><div class="order-sign-box"><div class="order-sign-item"><div style="font-weight:bold">ä¾›æ–¹ç¡®è®¤</div><div class="order-sign-line"></div><div>(ç›–ç« /Signature)</div></div><div class="order-sign-item"><div style="font-weight:bold">éœ€æ–¹ç¡®è®¤</div><div class="order-sign-line"></div><div>(ç›–ç« /Signature)</div></div></div></div>
<script>
function showDialog(e,t,n){return new Promise(o=>{const i=document.getElementById("alert-backdrop"),l=document.getElementById("alert-actions");document.getElementById("alert-title").innerText=e||"æç¤º",document.getElementById("alert-msg").innerText=t||"",l.innerHTML="",n.forEach(e=>{const t=document.createElement("button");t.className=`alert-btn ${e.style||""}`,t.innerText=e.text,t.onclick=()=>{i.classList.remove("active"),setTimeout(()=>o(e.val),200)},l.appendChild(t)}),i.classList.add("active")})}async function iosAlert(e){return showDialog("æç¤º",e,[{text:"å¥½",val:!0,style:"bold"}])}async function iosConfirm(e,t="ç¡®è®¤æ“ä½œ"){return showDialog(t,e,[{text:"å–æ¶ˆ",val:!1},{text:"ç¡®å®š",val:!0,style:"bold"}])}async function iosDestructive(e,t="è­¦å‘Š",n="åˆ é™¤"){return showDialog(t,e,[{text:"å–æ¶ˆ",val:!1},{text:n,val:!0,style:"destructive"}])}const COMPANY_DATA={moyu:{name:"éƒ‘å·å¢¨äºˆæ–‡åŒ–åˆ›æ„æœ‰é™å…¬å¸",code:"91410105MAEB8W6Q4M",bank:"ä¸­å›½å·¥å•†é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸éƒ‘å·äºŒåä¸€ä¸–çºªæ”¯è¡Œ",acc:"1702222009100163562",signer:"æ¥šä»•ç…œ"},xinyun:{name:"æ²³å—çœæ–°è¿åŒ…è£…çº¸å“æœ‰é™å…¬å¸",code:"91410105MA9GNE008R",bank:"ä¸­å›½å·¥å•†é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸éƒ‘å·äºŒåä¸€ä¸–çºªæ”¯è¡Œ",acc:"1702222009100057503",signer:""},chuangyi:{name:"æ²³å—çœåˆ›è‰ºä¼—åˆåŒ…è£…æœ‰é™è´£ä»»å…¬å¸",code:"91410700MAEQMMJQXH",bank:"ä¸­å›½å»ºè®¾é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸æ–°ä¹¡ä¸­åŸå†œè°·æ”¯è¡Œ",acc:"41050163284800002146",signer:""}},DEFAULT_TERMS={check:"1ã€æŒ‰åˆåŒè¦æ±‚æ ·å“ä¿è¯å°åˆ·è´¨é‡å’Œæ•°é‡ï¼Œæ•°é‡è¯¯å·®ä¸ºÂ±10ï¼…ã€‚\n2ã€æ ¹æ®ç”²æ–¹æ‰€å‘æ–‡ä»¶ä¸ºå‡†å°åˆ·å‡ºç‰ˆã€‚\n3ã€æ ¹æ®ç”²æ–¹æ‰€å‘æ–‡ä»¶ä¸ºå‡†ï¼Œè‰²å·®è¯¯å·®ç‡ä¸ºÂ±10ï¼…ã€‚\n4ã€ä¹™æ–¹äº¤ä»˜å°åˆ·å“åï¼Œç”²æ–¹å¦‚æœ‰è´¨é‡å¼‚è®®ï¼Œåº”åœ¨3æ—¥ä»¥å†…ä»¥ä¹¦é¢å½¢å¼å‘ä¹™æ–¹æå‡ºï¼Œå¦åˆ™è§†ä¸ºå…¨éƒ¨äº§å“éªŒæ”¶åˆæ ¼ã€‚\n5ã€ä¹™æ–¹é€è´§åˆ°ç”²æ–¹ï¼Œç”±ç”²æ–¹å§”æ‰˜ç›¸å…³äººå‘˜ç­¾å­—æ¥æ”¶ã€ä¸€å¾‹è§†ä¸ºç”²æ–¹å…¬å¸è¡Œä¸ºã€ä¸€åˆ‡åæœæœ‰ç”²æ–¹å…¬å¸æ‰¿æ‹…ã€‚\n6ã€ä»˜æ¬¾å’Œäº¤ä»˜æ–¹å¼ï¼šç”²æ–¹å‘ä¹™æ–¹äº¤ä»˜é¢è´°ä»Ÿè‚†ä½°å…ƒæ•´ã€‚\n7ã€å…¶ä»–ï¼šæ¥ç¨¿ç”Ÿäº§ï¼ŒæŒ‰æ–‡ä»¶å°åˆ·ç”Ÿäº§ã€‚",liab:"1ã€ç”²æ–¹å¦‚ä¸­é€”å˜æ›´å°å“çš„æ•°é‡ã€è§„æ ¼å’Œå†…å®¹ï¼Œåº”æ‰¿æ‹…ä¹™æ–¹å·²åŠ å·¥ç”Ÿäº§çš„ç›¸å…³è´¹ç”¨ï¼Œäº¤è´§æ—¥æœŸé‡æ–°è®¡ç®—ã€‚\n2ã€ç”²æ–¹ä¸­é€”è§£é™¤åˆåŒï¼Œåº”æ‰¿æ‹…ä¹™æ–¹ä¸ºå±¥è¡Œæœ¬åˆåŒé€ æˆçš„å…¨éƒ¨æŸå¤±ï¼ˆåŒ…æ‹¬è®¾è®¡ã€åˆ¶ä½œæ‰“æ ·ã€äººå·¥åŠåŸææ–™ç­‰è´¹ç”¨åŠæˆæœ¬æŸå¤±ï¼‰ã€‚æ‰€äº¤è®¢é‡‘ä¸äºˆé€€å›ã€‚\n3ã€ä¹™æ–¹åº”æŒ‰æ—¶å°†è´§é€å¾€åŒæ–¹çº¦å®šçš„äº¤è´§åœ°ç‚¹ï¼Œå¦‚å› è´¨é‡é—®é¢˜é€ æˆç”²æ–¹æ‹’ç»æè´§ï¼Œæ‰€é€ æˆçš„æŸå¤±åº”ç”±ä¹™æ–¹æ‰¿æ‹…ã€‚å¦‚éè´¨é‡é—®é¢˜é€ æˆç”²æ–¹æ‹’ç»æè´§ï¼Œæ‰€é€ æˆçš„æŸå¤±ç”±ç”²æ–¹æ‰¿æ‹…ã€‚è‹¥ä¹™æ–¹ä¸æŒ‰çº¦å®šæ—¶é—´äº¤è´§ï¼ŒæŒ‰åˆåŒçº¦å®šè´§æ¬¾æ€»æ¬¾æ—¥5â€°æ‰¿æ‹…è¿çº¦é‡‘ã€‚è‹¥ç”²æ–¹éœ€è¦çš„è´§å“ä¹™æ–¹æŒ‰æœŸå®Œæˆåï¼Œå› ç”²æ–¹åŸå› ä¸æè´§ï¼Œç”²æ–¹åº”æ‰¿æ‹…è¯¥ç¬”å…¨éƒ¨è´§æ¬¾ä»¥åŠå› è´§ç‰©åº“å­˜å¯¼è‡´çš„è´§æ¬¾ä»·æ¬¾åˆ©æ¯åŠä»“åº“è´¹ç”¨ï¼Œå¯¹æ­¤ä¹™æ–¹æœ‰æƒå‘ç”²æ–¹ä¸»å¼ ä¸Šè¿°å…¨éƒ¨å®é™…ç›´æ¥æŸå¤±ä»¥åŠé—´æ¥æŸå¤±è¯‰è®¼ã€‚\n4ã€ç”²æ–¹åº”ä¿è¯æ‰€æä¾›çš„è®¾è®¡å°åˆ·èµ„æ–™æ‹¥æœ‰è‡ªä¸»çŸ¥è¯†äº§æƒå’Œåˆæ³•ä½¿ç”¨æƒï¼Œç‰ˆæƒå½’ç”²æ–¹æ‰€æœ‰ï¼Œç”±æ­¤å‘ç”Ÿçš„æ³•å¾‹è´£ä»»ç”±ç”²æ–¹è´Ÿè´£ï¼Œé€ æˆä¹™æ–¹çš„æŸå¤±ç”±ç”²æ–¹èµ”å¿ã€‚\n5ã€ä¹™æ–¹å¯¹ç”²æ–¹è®¾è®¡å°åˆ·çš„äº§å“è®¾è®¡æä¾›ç”²æ–¹ä»¥å¤–çš„ç¬¬ä¸‰è€…ï¼Œä¸å¾—å°†ç”²æ–¹å°åˆ·äº§å“è‡ªä¹™æ–¹æ¸ é“æµé€šã€‚ç”²æ–¹æä¾›çš„åˆ¶ä½œæ–‡ä»¶ï¼Œå¦‚æœ‰çŸ¥è¯†äº§æƒã€ç‰ˆæƒçº çº·çš„ï¼Œç”²æ–¹è´Ÿè´£åè°ƒå¤„ç†ï¼Œæ‰¿æ‹…ä¸€åˆ‡å¸¦æ¥çš„æŸå¤±ã€‚ä¹™æ–¹ä¸æ‰¿æ‹…å› çŸ¥è¯†äº§æƒå’Œç‰ˆæƒå¸¦æ¥çš„ä¸€åˆ‡è´£ä»»ã€‚\n6ã€ä¹™æ–¹åº”ä¿è¯å°åˆ·è´¨é‡ï¼Œä¸¥æ ¼æŒ‰ç”²æ–¹æ‰€ç­¾æ ·å“ä¸ºå‡†ï¼Œåœ¨æŠ€æœ¯å‡†è®¸çš„è¯¯å·®èŒƒå›´å†…å®Œæˆå°åˆ¶å·¥ä½œã€‚\n7ã€ç”²æ–¹åº”æŒ‰åˆåŒè§„å®šæ—¶é—´æ”¯ä»˜ç»™ä¹™æ–¹è´§æ¬¾ï¼Œå¦‚è‹¥é€¾æœŸæ”¯ä»˜ï¼ŒæŒ‰åˆåŒæ€»é¢æ—¥5â€°å‘ä¹™æ–¹æ”¯ä»˜è¿çº¦é‡‘ï¼Œç›´è‡³ä»˜æ¸…ä¸ºæ­¢ã€‚\n8ã€æœ¬åˆåŒå±¥è¡Œè¿‡ç¨‹ä¸­å¦‚å› ä¸å¯æŠ—åŠ›çš„åŸå› å½±å“å±¥è¡Œçš„ï¼Œåº”åœ¨ä¸å¯æŠ—åŠ›å‘ç”Ÿå3æ—¥å†…é€šçŸ¥å¯¹æ–¹ï¼Œåå•†è§£å†³ã€‚\n9ã€ç”²ã€ä¹™åŒæ–¹åœ¨å±¥è¡ŒåˆåŒè¿‡ç¨‹ä¸­ï¼Œå¦‚å‘ç”Ÿçº çº·ï¼ŒåŒæ–¹åº”æœ¬ç€å‹å¥½åˆä½œçš„ç²¾ç¥ï¼Œé‡‡å–æœ‰æ•ˆçš„æ–¹å¼åå•†è§£å†³ï¼Œå¦‚åå•†ä¸æˆï¼Œç»åŒæ–¹åŒæ„ï¼Œç”±ä¹™æ–¹æ‰€åœ¨åœ°äººæ°‘æ³•é™¢è¯‰è®¼è§£å†³ã€‚\n10ã€æœ¬åˆåŒä¸€å¼ä¸¤ä»½ï¼Œç”²ã€ä¹™åŒæ–¹å…±åŒæ‰§æœ‰ï¼Œå…·æœ‰åŒç­‰çš„æ³•å¾‹æ•ˆåŠ›ã€‚\n11ã€æœ‰å…³ä¸å±¥è¡Œæœ¬åˆåŒæœ‰å…³çš„ä¼ çœŸä»¶ã€æ‰«æä»¶ã€å¾®ä¿¡æˆªå›¾éƒ½æ˜¯æœ¬åˆåŒç»„æˆéƒ¨åˆ†å…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚\n12ã€æœ¬åˆåŒè‡ªåŒæ–¹ç­¾ç« ä¹‹æ—¥èµ·ç”Ÿæ•ˆã€‚"};let customers=[],historyData=[],editingCustId=null;async function generatePdf(e,t){if(!document.getElementById("party-a").value)return void await iosAlert("è¯·å…ˆå¡«å†™å®¢æˆ·åç§°");const n=document.getElementById(e);document.getElementById("loading").style.display="flex",n.style.transform="none",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.zIndex="1001";try{const e=await html2canvas(n,{scale:2,useCORS:!0}),o=e.toDataURL("image/jpeg",.95),{jsPDF:i}=window.jspdf,l=new i("p","mm","a4"),a=l.getImageProperties(o),c=a.height*210/a.width;let r=c,s=0;for(l.addImage(o,"JPEG",0,s,210,c),r-=297;r>0;)s=r-c,l.addPage(),l.addImage(o,"JPEG",0,s,210,c),r-=297;l.save(`${t}_${document.getElementById("party-a").value}.pdf`)}catch(e){console.error(e),await iosAlert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{n.style.transform="translate(-9999px, -9999px)",n.style.position="fixed",document.getElementById("loading").style.display="none"}}async function exportContract(){await commonCheck()&&(await saveToHistory(!0),fillPrintData("contract"),await generatePdf("print-contract-container","åˆåŒ"))}async function exportOrder(){await commonCheck()&&(await saveToHistory(!0),fillPrintData("order"),await generatePdf("print-order-container","è®¢è´§å•"))}async function commonCheck(){return!!document.getElementById("party-a").value||(await iosAlert("è¯·å…ˆå¡«å†™å®¢æˆ·åç§°"),!1)}function fillPrintData(e){const t={"c-no":["p-no","o-no"],"c-loc":["p-loc"],"c-date":["p-date","o-date"],"party-a":["p-party-a","o-buyer-name","p-sign-comp-a"],"sign-b-comp":["p-party-b-top","o-seller-name","p-sign-comp-b"],craft:["p-craft","o-craft"],"term-date":["p-del-date","o-date-del"],"term-addr":["p-del-addr","o-addr-del"],"term-pay":["p-pay"],"term-check":["p-terms-check"],"term-liab":["p-terms-liab"],"sign-a-addr":["p-sign-addr-a","o-buyer-addr"],"sign-a-phone":["p-sign-phone-a","o-buyer-phone"],"sign-a-user":["p-sign-user-a","o-buyer-contact"],"sign-b-code":["p-sign-code-b"],"sign-b-bank":["p-sign-bank-b"],"sign-b-acc":["p-sign-acc-b"],"sign-b-user":["p-sign-user-b","o-seller-contact"]};for(let n in t){const o=document.getElementById(n).value;t[n].forEach(t=>{const i=document.getElementById(t);i&&("c-date"===n?i.innerText=formatDateCN(o):i.innerText=o)})}document.getElementById("o-bank-info").innerText=`${document.getElementById("sign-b-bank").value} (${document.getElementById("sign-b-acc").value})`;const n="contract"===e?"p-tbody":"o-tbody",o=document.getElementById(n);o.innerHTML="",document.querySelectorAll("#p-list tr").forEach((t,i)=>{const l=t.querySelectorAll("input"),a="contract"===e?`<td style="text-align:center">${i+1}</td><td>${l[0].value}</td><td>${l[1].value}</td><td style="text-align:center">${l[2].value}</td><td style="text-align:center">${l[3].value}</td><td style="text-align:right">${l[4].value}</td><td style="text-align:right">${l[5].value}</td>`:`<td style="text-align:center">${i+1}</td><td>${l[0].value}</td><td>${l[1].value}</td><td style="text-align:center">${l[2].value}</td><td style="text-align:center">${l[3].value}</td><td style="text-align:center">${l[4].value}</td><td style="text-align:right">${l[5].value}</td>`,c=document.createElement("tr");c.innerHTML=a,o.appendChild(c)});const{sum:i,count:l}=calcTotal();"contract"===e?(document.getElementById("p-total-cn").innerText=n2c(i),document.getElementById("p-total-num").innerText="Â¥"+i.toLocaleString("en-US",{minimumFractionDigits:2})):(document.getElementById("o-total-qty").innerText=l,document.getElementById("o-total-money").innerText="Â¥"+i.toLocaleString("en-US",{minimumFractionDigits:2}))}function initHistory(){const e=localStorage.getItem("orderSys_history");e&&(historyData=JSON.parse(e))}async function saveToHistory(e=!1){const t=collectCurrentData();if(!t.partyA)return void(e||await iosAlert("è¯·å…ˆå¡«å†™å®¢æˆ·åç§°"));const n=historyData[0];if(n&&n.data.no===t.no&&Date.now()-n.id<12e4)historyData[0].data=t,historyData[0].total=document.getElementById("total-display").innerText;else{const e={id:Date.now(),date:(new Date).toLocaleString(),client:t.partyA,total:document.getElementById("total-display").innerText,data:t};historyData.unshift(e),historyData.length>50&&historyData.pop()}if(localStorage.setItem("orderSys_history",JSON.stringify(historyData)),!e){const e=document.getElementById("save-status");e.style.display="inline",setTimeout(()=>e.style.display="none",2e3)}}function openHistoryModal(){document.getElementById("history-modal").classList.add("active"),renderHistoryList()}function renderHistoryList(){const e=document.getElementById("history-search").value.toLowerCase(),t=document.getElementById("history-list");t.innerHTML="";const n=historyData.filter(t=>t.client.toLowerCase().includes(e)||t.date.includes(e));if(0===n.length)return void(t.innerHTML='<div style="text-align:center;color:#999;padding:40px">æ²¡æœ‰è®°å½•</div>');n.forEach(e=>{const n=document.createElement("div");n.className="list-item",n.innerHTML=`\n                <div class="list-info" style="flex:1" onclick="loadHistoryItem(${e.id})"><b>${e.client}</b><small>${e.date} Â· ${e.total}</small></div>\n                <button class="action-btn btn-sm" onclick="delHistory(${e.id}, event)" style="color:var(--danger)"><i class="fas fa-trash"></i></button>`,t.appendChild(n)})}async function loadHistoryItem(e){await iosConfirm("å½“å‰å†…å®¹å°†è¢«è¦†ç›–ï¼Œç¡®å®šåŠ è½½ï¼Ÿ")&&((historyData.find(t=>t.id===e)||{}).data&&(restoreData(historyData.find(t=>t.id===e).data),closeModal("history-modal")))}async function delHistory(e,t){t.stopPropagation(),await iosDestructive("è®°å½•åˆ é™¤åæ— æ³•æ¢å¤","ç¡®å®šåˆ é™¤ï¼Ÿ")&&(historyData=historyData.filter(t=>t.id!==e),localStorage.setItem("orderSys_history",JSON.stringify(historyData)),renderHistoryList())}function addRow(e={}){const t=document.createElement("tr");t.innerHTML=`<td style="text-align:center;color:#ccc"></td><td style="display:flex; gap:4px; justify-content:center;"><button class="action-btn btn-sm" onclick="moveRow(this, -1)"><i class="fas fa-arrow-up"></i></button><button class="action-btn btn-sm" onclick="moveRow(this, 1)"><i class="fas fa-arrow-down"></i></button><button class="action-btn btn-sm" onclick="removeRow(this)" style="color:var(--danger)"><i class="fas fa-times"></i></button></td><td><input value="${e.name||""}" class="p-name" list="product-options" onchange="saveData()"></td><td><input value="${e.mat||""}" list="material-options" onchange="saveData()"></td><td><input value="${e.size||""}" onchange="saveData()"></td><td><input value="${e.qty||""}" class="p-qty" type="number" onchange="saveData()"></td><td><input value="${e.price||""}" class="text-right p-price" type="number" onchange="saveData()"></td><td><input value="${e.total||""}" class="text-right p-total" type="number" onchange="saveData()"></td>`,document.getElementById("p-list").appendChild(t),updateIdx()}function moveRow(e,t){const n=e.closest("tr");-1===t&&n.previousElementSibling?n.parentNode.insertBefore(n,n.previousElementSibling):1===t&&n.nextElementSibling&&n.parentNode.insertBefore(n.nextElementSibling,n),updateIdx(),saveData()}function removeRow(e){e.closest("tr").remove(),calcTotal(),saveData(),updateIdx()}function updateIdx(){document.querySelectorAll("#p-list tr").forEach((e,t)=>e.cells[0].innerText=t+1)}function collectCurrentData(){const e=[];return document.querySelectorAll("#p-list tr").forEach(t=>{const n=t.querySelectorAll("input");e.push({name:n[0].value,mat:n[1].value,size:n[2].value,qty:n[3].value,price:n[4].value,total:n[5].value})}),{no:document.getElementById("c-no").value,loc:document.getElementById("c-loc").value,date:document.getElementById("c-date").value,partyA:document.getElementById("party-a").value,craft:document.getElementById("craft").value,termDate:document.getElementById("term-date").value,termAddr:document.getElementById("term-addr").value,termPay:document.getElementById("term-pay").value,termCheck:document.getElementById("term-check").value,termLiab:document.getElementById("term-liab").value,signAAddr:document.getElementById("sign-a-addr").value,signAPhone:document.getElementById("sign-a-phone").value,signAUser:document.getElementById("sign-a-user").value,partyBSelect:document.getElementById("party-b-select").value,signBUser:document.getElementById("sign-b-user").value,products:e}}function restoreData(e){document.getElementById("c-no").value=e.no,document.getElementById("c-loc").value=e.loc,document.getElementById("c-date").value=e.date,document.getElementById("party-a").value=e.partyA,document.getElementById("craft").value=e.craft,document.getElementById("term-date").value=e.termDate,document.getElementById("term-addr").value=e.termAddr,document.getElementById("term-pay").value=e.termPay,document.getElementById("term-check").value=e.termCheck||DEFAULT_TERMS.check,document.getElementById("term-liab").value=e.termLiab||DEFAULT_TERMS.liab,document.getElementById("sign-a-addr").value=e.signAAddr||"",document.getElementById("sign-a-phone").value=e.signAPhone||"",document.getElementById("sign-a-user").value=e.signAUser||"",e.partyBSelect&&(document.getElementById("party-b-select").value=e.partyBSelect),updatePartyB(!1),e.signBUser&&(document.getElementById("sign-b-user").value=e.signBUser);const t=document.getElementById("p-list");t.innerHTML="",e.products&&e.products.length?e.products.forEach(e=>addRow(e)):addRow(),calcTotal()}function backupAll(){const e={version:"5.0",timestamp:(new Date).toISOString(),current:collectCurrentData(),customers:customers,history:historyData},t=new Blob([JSON.stringify(e)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=`Backup_${(new Date).toISOString().slice(0,10)}.json`,n.click()}function importData(e){const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=async function(e){try{const t=JSON.parse(e.target.result);t.version?await iosConfirm("è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Ÿ")&&(customers=t.customers||[],historyData=t.history||[],localStorage.setItem("orderSys_customers",JSON.stringify(customers)),localStorage.setItem("orderSys_history",JSON.stringify(historyData)),t.current&&restoreData(t.current),await iosAlert("æ•°æ®æ¢å¤æˆåŠŸï¼")):Array.isArray(t)&&(customers=t,localStorage.setItem("orderSys_customers",JSON.stringify(customers)),await iosAlert("å®¢æˆ·åˆ—è¡¨å¯¼å…¥æˆåŠŸ")),updateCustDatalist(),document.getElementById("cust-modal").classList.contains("active")&&renderCustList()}catch(e){await iosAlert("æ–‡ä»¶æ ¼å¼é”™è¯¯")}},n.readAsText(t)}function initData(){const e=localStorage.getItem("orderSys_v1");if(e)try{restoreData(JSON.parse(e))}catch(e){resetAll()}else resetAll(!1)}function saveData(){localStorage.setItem("orderSys_v1",JSON.stringify(collectCurrentData()))}async function resetAll(e=!0){e&&!await iosDestructive("å½“å‰é¡µé¢å°†è¢«æ¸…ç©º","ç¡®å®šå¼€æ–°å•å—ï¼Ÿ","æ¸…ç©º")||(genNo(),document.getElementById("c-date").value=(new Date).toISOString().split("T")[0],document.getElementById("term-check").value=DEFAULT_TERMS.check,document.getElementById("term-liab").value=DEFAULT_TERMS.liab,document.getElementById("p-list").innerHTML="",updatePartyB(),addRow({name:"åŒæ’ç›’",mat:"350Gç™½å¡"}),updateItem6(),calcTotal())}function initCustomers(){const e=localStorage.getItem("orderSys_customers");e&&(customers=JSON.parse(e)),updateCustDatalist()}function updateCustDatalist(){document.getElementById("customer-list-options").innerHTML=customers.map(e=>`<option value="${e.name}">`).join("")}function onPartyAChange(){const e=document.getElementById("party-a").value,t=customers.find(t=>t.name===e);t&&(document.getElementById("sign-a-user").value=t.contact,document.getElementById("sign-a-phone").value=t.phone,document.getElementById("sign-a-addr").value=t.addr,saveData())}function openCustModal(){document.getElementById("cust-modal").classList.add("active"),renderCustList(),toggleCustForm(!1)}function closeModal(e){document.getElementById(e).classList.remove("active"),updateCustDatalist()}function renderCustList(){const e=document.getElementById("cust-list");e.innerHTML="",customers.forEach((t,n)=>{const o=document.createElement("div");o.className="list-item",o.innerHTML=`\n            <div class="list-info" style="flex:1" onclick="fillCust(${n})"><b>${t.name}</b><small>${t.contact||"-"} | ${t.phone||"-"}</small></div>\n            <div style="display:flex; gap:10px">\n                <button class="action-btn btn-sm" onclick="editCust(${n})"><i class="fas fa-pen"></i></button>\n                <button class="action-btn btn-sm" onclick="delCust(${n})" style="color:var(--danger)"><i class="fas fa-trash"></i></button>\n            </div>`,e.appendChild(o)})}function fillCust(e){document.getElementById("party-a").value=customers[e].name,onPartyAChange(),closeModal("cust-modal")}async function saveCustomer(){const e=document.getElementById("cust-name").value;if(!e)return await iosAlert("è¯·å¡«å†™å…¬å¸åç§°");const t={name:e,contact:document.getElementById("cust-contact").value,phone:document.getElementById("cust-phone").value,addr:document.getElementById("cust-addr").value};null!==editingCustId?customers[editingCustId]=t:customers.push(t),localStorage.setItem("orderSys_customers",JSON.stringify(customers)),renderCustList(),toggleCustForm(!1)}function editCust(e){toggleCustForm(!0);const t=customers[e];document.getElementById("cust-name").value=t.name,document.getElementById("cust-contact").value=t.contact,document.getElementById("cust-phone").value=t.phone,document.getElementById("cust-addr").value=t.addr,editingCustId=e}async function delCust(e){await iosDestructive("åˆ é™¤è¯¥å®¢æˆ·èµ„æ–™ï¼Ÿ")&&(customers.splice(e,1),localStorage.setItem("orderSys_customers",JSON.stringify(customers)),renderCustList())}function toggleCustForm(e){document.getElementById("cust-form-area").style.display=e?"block":"none",e&&(editingCustId=null,document.querySelectorAll("#cust-form-area input").forEach(e=>e.value=""))}function updatePartyB(e=!0){const t=document.getElementById("party-b-select").value,n=COMPANY_DATA[t];document.getElementById("sign-b-comp").value=n.name,document.getElementById("sign-b-code").value=n.code,document.getElementById("sign-b-bank").value=n.bank,document.getElementById("sign-b-acc").value=n.acc,e&&(document.getElementById("sign-b-user").value=n.signer)}function genNo(){const e=new Date;document.getElementById("c-no").value=`HNMY-${e.getFullYear()}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getDate().toString().padStart(2,"0")}${Math.floor(90*Math.random())+10}`,saveData()}function calcTotal(){let e=0,t=0;return document.querySelectorAll(".p-total").forEach(t=>e+=parseFloat(t.value)||0),document.querySelectorAll(".p-qty").forEach(e=>t+=parseFloat(e.value)||0),e=Math.round(100*e)/100,document.getElementById("total-display").innerText="Â¥"+e.toLocaleString("en-US",{minimumFractionDigits:2}),{sum:e,count:t}}function updateItem6(){const e=document.getElementById("term-pay").value||"å…¨æ¬¾",t=document.getElementById("term-addr").value||"ç”²æ–¹æŒ‡å®šåœ°å€",n=document.getElementById("term-check");let o=n.value;const i=`6ã€ä»˜æ¬¾å’Œäº¤ä»˜æ–¹å¼ï¼šç»“ç®—æ–¹å¼ä¸ºâ€œ${e}â€ï¼Œäº¤è´§åœ°ç‚¹ä¸ºâ€œ${t}â€ã€‚`,l=/6ã€ä»˜æ¬¾å’Œäº¤ä»˜æ–¹å¼ï¼š[\s\S]*?(?=\n7ã€|$)/;l.test(o)&&(n.value=o.replace(l,i))}function clearInput(e){document.getElementById(e).value="",saveData()}function n2c(e){if(!e||0==e)return"é›¶å…ƒæ•´";let t="ä»Ÿä½°æ‹¾äº¿ä»Ÿä½°æ‹¾ä¸‡ä»Ÿä½°æ‹¾å…ƒè§’åˆ†",n="";e+="00";let o=e.indexOf(".");o>=0&&(e=e.substring(0,o)+e.substr(o+1,2)),t=t.substr(t.length-e.length);for(let o=0;o<e.length;o++)n+="é›¶å£¹è´°åè‚†ä¼é™†æŸ’æŒç–".charAt(e.charAt(o))+t.charAt(o);return n.replace(/é›¶(ä»Ÿ|ä½°|æ‹¾|è§’)/g,"é›¶").replace(/(é›¶)+/g,"é›¶").replace(/é›¶(ä¸‡|äº¿|å…ƒ)/g,"$1").replace(/(äº¿)ä¸‡|å£¹(æ‹¾)/g,"$1$2").replace(/^å…ƒé›¶?|é›¶åˆ†/g,"").replace(/å…ƒ$/g,"å…ƒæ•´")}function formatDateCN(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()} å¹´ ${t.getMonth()+1} æœˆ ${t.getDate()} æ—¥`}window.onload=function(){initCustomers(),initHistory(),initData(),document.getElementById("p-list").addEventListener("input",e=>{if("INPUT"!==e.target.tagName)return;const t=e.target.closest("tr"),n=parseFloat(t.querySelector(".p-qty").value)||0,o=parseFloat(t.querySelector(".p-price").value)||0,i=t.querySelector(".p-total");(e.target.classList.contains("p-qty")||e.target.classList.contains("p-price"))&&n&&o?i.value=Math.round(n*o*100)/100:e.target.classList.contains("p-total")&&0!==n&&(t.querySelector(".p-price").value=(parseFloat(i.value)||0/n).toFixed(2)),calcTotal(),saveData()}),["term-pay","term-addr"].forEach(e=>{document.getElementById(e).addEventListener("input",()=>{updateItem6(),saveData()})})};
</script></body></html>
